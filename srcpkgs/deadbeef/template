# Template file for 'deadbeef'
pkgname=deadbeef
version=1.9.5
revision=1
create_wrksrc=yes
build_style=gnu-configure
configure_args="--disable-oss --disable-notify --disable-gtk2"
hostmakedepends="automake libtool gettext gettext-devel intltool pkg-config
 yasm clang glib-devel libdispatch-devel"
makedepends="
 alsa-lib-devel dbus-devel faad2-devel ffmpeg-devel gtk+3-devel imlib2-devel
 jansson-devel libcddb-devel libcdio-devel libcurl-devel libflac-devel
 libmad-devel libpng-devel libsamplerate-devel libsndfile-devel libvorbis-devel
 libzip-devel mpg123-devel opusfile-devel pulseaudio-devel wavpack-devel pipewire-devel git patch clang"
depends="desktop-file-utils hicolor-icon-theme"
short_desc="Ultimate Music Player for GNU/Linux"
maintainer="Ilya <ISPonomarev@yahoo.com>"
license="Zlib, GPL-2.0-or-later, LGPL-2.1-or-later"
homepage="https://deadbeef.sourceforge.io"
changelog="https://deadbeef.sourceforge.io/news0.html"
distfiles="https://sourceforge.net/projects/deadbeef/files/travis/linux/${version}/deadbeef-${version}.tar.bz2"
checksum="74c4478edccfee8a978d4adbeeb208f049bef63982f4df19ee208aaad8a6cd26"
LDFLAGS+=" -Wl,-z,stack-size=1048576"

# The soundtouchup plugin was made default in 1.8.4 and fails to build on i686.
# Fixing that might be a good maintainer task.
case "$XBPS_TARGET_MACHINE" in
	i686*) configure_args+=" --disable-soundtouch" ;;
esac

if [ "$XBPS_TARGET_LIBC" = "musl" ]; then
	makedepends+=" musl-legacy-compat"
fi

post_extract() {
	mv deadbeef-${version}/* .
}

do_configure() {
        CC=clang CXX=clang++ ./configure ${configure_args}
}

post_install() {
	vlicense COPYING
}

deadbeef-devel_package() {
	short_desc+=" - development files"
	depends="${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		vmove usr/include
	}
}
